<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: vmware | shigeponが関心のある技術情報など]]></title>
  <link href="http://blog.shigepon.info/blog/categories/vmware/atom.xml" rel="self"/>
  <link href="http://blog.shigepon.info/"/>
  <updated>2016-01-06T12:19:53+09:00</updated>
  <id>http://blog.shigepon.info/</id>
  <author>
    <name><![CDATA[shigepon]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Vmware Esxiがfatal error 33を出したのでインストールしなおしてついでに色々試した話]]></title>
    <link href="http://blog.shigepon.info/blog/2015/08/05/esxi-shows-fatal-error-33/"/>
    <updated>2015-08-05T16:45:31+09:00</updated>
    <id>http://blog.shigepon.info/blog/2015/08/05/esxi-shows-fatal-error-33</id>
    <content type="html"><![CDATA[<p>Vmware Esxiがある日</p>

<p><code>sh
error loading /s.v00
fatal error: 33 inconsistent data
</code></p>

<p>というメッセージを出して起動しなくなったので、修復方法をメモしておく</p>

<h2>結論</h2>

<p>まず結論から言うと、Vmware Esxiを入れ直すことになった。他にも方法があるらしいが、その方法のページが途中で会員登録しないと見れなくなったので、参考にしなかった。</p>

<p>参考：
<a href="https://communities.vmware.com/thread/342182">error loading s.v00 fatal error 33 inconsistent&hellip; | VMware Communities</a></p>

<h2>Vmware Esxiの入れ直し</h2>

<p>USBにインストールしていたので、要はそのままインストールし直すだけなんだけど、以下手順</p>

<ul>
<li>Esxiのisoをダウンロード

<ul>
<li><a href="https://my.vmware.com/jp/web/vmware/login">my vmware</a>からログイン(ユーザー登録はフォームに記入して・・・という良くある方法なので省略)
&mdash; <a href="https://my.vmware.com/group/vmware/downloads#tab2">製品ダウンロード</a>に移動</li>
<li>VMware vSphere Hypervisor (ESXi)の横の<a href="https://my.vmware.com/group/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere_hypervisor_esxi/6_0">View Download Components</a>をクリック</li>
<li>左にバージョン選択用のコンボボックスがあるので、バージョンを選択して、Downloadリンクをクリック</li>
<li>Registerのボタンが出てる場合、まずクリックして、ライセンスの登録を行う</li>
<li>License Informationにlicense keysが出るので保存しておく。(Vmware ESXi Clientでのライセンスキー登録に使う)</li>
<li>ライセンスの登録が済んだらDownload Packages以下の項目からダウンロードするためのリンクが出るのでダウンロードする</li>
<li><strong><em>AdBlockを入れてるとダウンロードが開始しなかったので注意</em></strong></li>
</ul>
</li>
<li>ダウンロードしたisoをCDに焼く</li>
<li>Esxiのハード要件を全て満たすハード上でCD起動する</li>
<li>ESXiをインストールする

<ul>
<li>Boot MenuでESXi Installerを選択する</li>
<li>インストールを進めるかどうか聞かれる(Enter)</li>
<li>ライセンス許諾を聞かれる(F11でおk)</li>
<li>インストール先を選ぶ(入れたい場所を選ぶ。USB差しておけばUSBも出て選択出来る)</li>
<li>キーボードレイアウトを選択する</li>
<li>rootアカウントのパスワードを設定する(タブで移動、2回設定するEnterで完了)</li>
<li>最後の確認(F11でおk)</li>
<li>インストール終了後Enterで再起動</li>
</ul>
</li>
</ul>


<h2>バージョン5.5、6.0</h2>

<p>今まで入れてたのがEsxiバージョン5.0だったので、ついでに5.5、6.0を試してみた。インストール方法は入れ直し方法と同じ。</p>

<p>で、インストール後にクライアントをDLしてホストに接続してみた。どのバージョンでも問題なく出来たが、Windows XPの端末ではこの2つのバージョンは接続出来ないそうな。</p>

<p>Vmの操作（インベントリへの追加、起動、コンソール表示、終了）は全てのバージョンで同じように出来た。Vmはバージョン5で作ったものだが他のバージョンでの操作も問題ないらしい。これは便利。</p>

<h2>sshでEsxiホストを操作する</h2>

<p>linuxやmacからEsxiホストを操作して、vmの起動、終了とかやりたかったので、ついでに試してみた。手順は以下の通り</p>

<ul>
<li>EsxiホストでSSHを有効にする

<ul>
<li>初期画面からCustomize Systemへ移動(F2)</li>
<li>カーソルを上下移動して「Troubleshooting Options」のところでEnter</li>
<li>Disable ESXi Shellにカーソルを合わせてEnterを押すとEnable ESXi Shellに変わる</li>
<li>Disable SSHにカーソルを合わせてEnterを押すとEnable SSHに変わる</li>
<li>Restart Management Agentsにカーソルを合わせてEnterを押す</li>
</ul>
</li>
<li>ESXiクライアントでSSHを有効にする

<ul>
<li>インベントリが選択されている状態で、構成(Configuration) &ndash;> セキュリティプロファイル(Security Profile)の上部、サービス(Services)の「プロパティ(Properties)をクリック</li>
<li>SSHを選択し、オプション(Options)をクリック</li>
<li>ホストに連動して開始および停止(Start and stop with host)を選択し、サービスコマンドの開始(Start)ボタンを押す。その後okをクリックしてダイアログを消す。</li>
<li>同中部、ファイアウォール(Firewall)の「プロパティ(Properties)をクリック</li>
<li>SSHサーバ(SSH Server)をチェック</li>
<li>ファイアーウォール(Firewall)ボタンをクリック</li>
<li>IPアドレスの許可設定を行う。任意のIPアドレスからの接続を許可(Allow connections from any IP address)するのが一番楽。</li>
<li>okをクリックしていって、ダイアログを閉じる</li>
</ul>
</li>
</ul>


<p>以上で、linuxやmacから</p>

<p><code>sh
ssh root@ESXiのip
</code></p>

<p>でインストール時に指定したパスワードを入力するとsshでESXiホストにアクセス出来るようになる。</p>

<p>参考：<a href="http://www.serenity-networks.com/networking/how-to-enable-ssh-on-vmware-esxi-5-5-5-6-all-other-versions/">How To Enable SSH on VMware ESXi 5 / 5.5 / 6 &amp; All Other Versions | Serenity-Networks</a></p>

<h2>ESXiの管理コマンド(ごく一部。追記予定)</h2>

<h3>インベントリへのVMの追加、削除</h3>

<p>追加</p>

<p><code>sh
$ vim-cmd solo/registervm [vmxのパス.vmx] [vm名]
</code></p>

<p>削除</p>

<p><code>sh
$ vim-cmd vmsvc/unregister [vmのid]
</code></p>

<h3>vm一覧</h3>

<p><code>sh
$ vim-cmd vmsvc/getallvms
</code></p>

<p>ここで出て来たvmidをvmのidとして色んなコマンド内で使用する。</p>

<h3>vm起動、シャットダウン</h3>

<p>起動</p>

<p><code>sh
$ vim-cmd vmsvc/power.on [vmのid]
</code></p>

<p>終了</p>

<p><code>sh
$ vim-cmd vmsvc/power.shutdown [vmのid]
</code></p>

<p>参考：<a href="http://qiita.com/binzume/items/096ce77f73b6e853c342">VMware ESXiをSSHでがんばるぞい(コマンドライン操作色々) &ndash; Qiita</a></p>

<p>ちなみに各コマンドについてはヘルプを出すオプションとか無いみたい。コマンド失敗した時に使用法が出ることもあるが、失敗するまで分からないとか怖いわー。</p>

<h3>ESXiシャットダウン</h3>

<p>シャットダウンと同時に電源を切る作業も必要</p>

<p><code>sh
$ shutdown.sh &amp;&amp; poweroff
</code></p>

<p>でおk。USBにインストールしているせいか分からないが、poweroffが無い場合、SSHの設定が再起動後、元に戻っていた。</p>

<p>参考：<a href="http://www.nojokeit.com/2013/02/shut-down-esxi-51-guest-vms-and-host.html">No Joke IT: Shut down ESXi 5.1 guest VMs and the host (free edition) via SSH &ndash; the easy way!</a></p>
]]></content>
  </entry>
  
</feed>
