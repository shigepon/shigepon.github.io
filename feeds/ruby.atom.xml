<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>shigeponが関心のある技術情報など</title><link href="http://blog.shigepon.info/" rel="alternate"></link><link href="http://blog.shigepon.info/feeds/ruby.atom.xml" rel="self"></link><id>http://blog.shigepon.info/</id><updated>2014-06-06T10:38:10+09:00</updated><entry><title>Railsやりにくいから挫折しそうという話</title><link href="http://blog.shigepon.info/blog/2014/06/06/difficult-to-use-rails/" rel="alternate"></link><updated>2014-06-06T10:38:10+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-06-06:blog/2014/06/06/difficult-to-use-rails/</id><summary type="html">&lt;p&gt;今までphpの&lt;a href="http://rhaco.org"&gt;rhaco&lt;/a&gt;というドマイナーなフレームワークを使ってきてたので、メジャーなフレームワークでも使ってみるかー。ついでにrubyの練習にもなるかーと思ってRails4をはじめたんだけど、なんかこー色々自分の開発方法に合ってないような気がするので挫折する。&lt;/p&gt;
&lt;p&gt;使いにくいなと思った点はメリットとの二律背反の部分もあるんだけど、次のような感じ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;モデルをコマンドで作ると、テーブル名が勝手に複数形になる&lt;/li&gt;
&lt;li&gt;viewでurl表示させたりするのが面倒。きっとやり方知らないだけだろうけど。&lt;/li&gt;
&lt;li&gt;コマンドありきで作っていくので、手作業でどこまで修正して良いか分からない&lt;/li&gt;
&lt;li&gt;どんな流れで処理が進むのかさっぱり分からない（フレームワークが大きすぎるから？）。本読めって話だろうけど・・・なー(めんどい)。&lt;/li&gt;
&lt;li&gt;分からない時に聞く相手が居ない&lt;/li&gt;
&lt;li&gt;バージョンによってやり方が結構変わるみたいで、ググってもそれが正しい手法か分からない時がある（これはrhacoも同じだからrhacoにも何とかして欲しいとこではある）&lt;/li&gt;
&lt;li&gt;Capistrano+nginx+unicornで結構ハマってそれだけで挫折しそうになった。未だにちゃんとunicornをリロード出来ない。&lt;/li&gt;
&lt;li&gt;メジャーなフレームワークのはずなのに、ちょこちょこバッドノウハウない？違う？&lt;/li&gt;
&lt;li&gt;SassやCoffeeScriptがデフォみたいなのがやだ&lt;/li&gt;
&lt;li&gt;いちいちgemファイルでほにゃららしないと上手く動かない？Bootstrapとか。そしてgemがあるかどうかをいちいちググって探さないといけない。&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;

&lt;p&gt;なんとなくだけどRailsって先に設計とかかっちりやってから作るってやり方な感じがして、「大雑把に作って、そこから細部をつめていく」みたいなやり方には合ってないんじゃないかと思った。個人でサクサクっとWebサービス作りたい場合には大雑把にまず作りたいんだよなー。&lt;/p&gt;
&lt;p&gt;見当違いかもしれないけどね。とりあえず他を当たってみる？メジャーどころでDjango？同じように挫折するかもしれないけどとりあえず試してみよう。&lt;/p&gt;</summary><category term="ruby"></category></entry><entry><title>Rails memo</title><link href="http://blog.shigepon.info/blog/2014/05/29/rails-memo/" rel="alternate"></link><updated>2014-05-29T08:54:12+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-05-29:blog/2014/05/29/rails-memo/</id><summary type="html">&lt;p&gt;Rails関係でいつでも確認出来るようにメモ。&lt;/p&gt;
&lt;h2&gt;ルーティングでのパラメータの使い方&lt;/h2&gt;
&lt;p&gt;config/route.rbを編集する&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;main/index/:hoge&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;main#index&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;app/controllers/main_controller.rbを編集&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MainController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;
  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;
    &lt;span class="vi"&gt;@hoge&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:hoge&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;!-- more --&gt;

&lt;p&gt;と書いておくとrouteで設定したパラメーターにアクセス出来る。&lt;/p&gt;
&lt;h2&gt;ルーティング中でURLの一部を省略可能にする&lt;/h2&gt;
&lt;p&gt;config/route.rbを編集する&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;main/index/:hoge(/fuga/:hage)&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;main#index&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;とやっておくと、main/index/1/fuga/2でもアクセス出来るし、main/index/1でもアクセス出来るようになる&lt;/p&gt;
&lt;h2&gt;ルーティング時にパラメーターの初期値を設定する&lt;/h2&gt;
&lt;p&gt;config/route.rbを編集する&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;main/index/:hoge(/fuga/:hage)&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;main#index&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="ss"&gt;:defaults&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;:hage&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;と設定しておくと、app/controllers/main_controller.rb中のparams[:hage]の初期値として3を入れることが出来る。&lt;/p&gt;
&lt;h2&gt;Dateクラスの使い方メモ&lt;/h2&gt;
&lt;p&gt;個人的に文字列からDateクラスにして、1年前にするとか1ヶ月前にするとかそういう作業をすることが多いのでメモ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strptime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2014-05-24&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%Y-%m-%d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;prev_year&lt;/span&gt; &lt;span class="c1"&gt;#1年前に指定&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="ruby"></category><category term="memo"></category></entry><entry><title>find\_by\_sqlでプリペアードステートメントを使う</title><link href="http://blog.shigepon.info/blog/2014/05/28/use-prepared-statement-in-find-by-sql/" rel="alternate"></link><updated>2014-05-28T08:19:12+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-05-28:blog/2014/05/28/use-prepared-statement-in-find-by-sql/</id><summary type="html">&lt;p&gt;ActiveRecordは便利なのかどうか知らないけど、allなどのメソッドで:conditionとかで?を使うことが出来る。だけど、sqlを直接打ちたいケースは必ず出てくるので、その時に?使いたいなと思ったけど、なかなか例文が無かった。&lt;/p&gt;
&lt;p&gt;んで結局こうするといいみたい。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="vi"&gt;@results&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find_by_sql&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;select * from hoge where fuga=?&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;しかし他にも直接sqlを実行する方法があって、&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raw_connection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;select * from hoge where fuga = :1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;hage&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;!-- more --&gt;

&lt;p&gt;こんな書き方も出来るらしい。ActiveRecord::Base.connectionでは無理らしい。うーむ。むか〜しからRailsはちょっとレールからはずれるととたんに難しくなるんだなー。やる気が減って来た＞＜。&lt;/p&gt;</summary><category term="Rails"></category><category term="ruby"></category></entry><entry><title>Railsでurl\_forを使ったらshows proxy\_passで設定したURLになってしまう件</title><link href="http://blog.shigepon.info/blog/2014/05/05/rails-url-for-shows-proxy-pass/" rel="alternate"></link><updated>2014-05-05T14:00:54+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-05-05:blog/2014/05/05/rails-url-for-shows-proxy-pass/</id><summary type="html">&lt;p&gt;Nginx, Unicorn, Rails4でurl_forを使ったら変なURLになってしまったので対処法を書いておく&lt;/p&gt;
&lt;p&gt;Ninxで&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;server&lt;/span&gt; &lt;span class="nt"&gt;hoge&lt;/span&gt;&lt;span class="nc"&gt;.com&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="nt"&gt;proxy_pass&lt;/span&gt; &lt;span class="nt"&gt;http&lt;/span&gt;&lt;span class="o"&gt;://&lt;/span&gt;&lt;span class="nt"&gt;upstream&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;のような設定をしているとurl_forで&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;http://hoge.com
&lt;/pre&gt;&lt;/div&gt;


&lt;!-- more --&gt;

&lt;p&gt;となってほしいところが&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;http://upstream
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;となってしまうので、ググって対処を調べた。&lt;/p&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/questions/5834025/how-to-preserve-request-url-with-nginx-proxy-pass"&gt;ruby - How to preserve request url with nginx proxy_pass - Stack Overflow&lt;/a&gt;を参考にして&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;proxy_set_header Host http://hoge.com
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;を追記したら上手く動いた。&lt;/p&gt;</summary><category term="Rails"></category><category term="ruby"></category></entry><entry><title>Rails4でJSONを出力する</title><link href="http://blog.shigepon.info/blog/2014/05/05/output-json-by-rails4/" rel="alternate"></link><updated>2014-05-05T10:33:26+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-05-05:blog/2014/05/05/output-json-by-rails4/</id><summary type="html">&lt;p&gt;Rails4にはjbuilderが標準で入っていて、viewを設定するだけでJSON出力が可能ならしい。
 例えば&lt;a href="http://blog.shigepon.info/blog/2014/03/10/a-way-of-creating-rails-application3/"&gt;Rails4でPostgreSQLとBootstrap使ったアプリを作ってみた(3):データ一覧ページを作って、詳細ページへのリンクを貼る - shigeponが関心のある技術情報など&lt;/a&gt;のページをとりあえずjsonで出力するにはapp/views/events/index.json.jbuilderを用意するだけでOK。http://0.0.0.0:3000/events/index.json にアクセスするとJSONで表示してくれる。なんと楽チンな！
 JSONの出力形式を変更する場合はindex.json.jbuilderを編集する&lt;/p&gt;
&lt;p&gt;例えばこんな感じ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@events&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;  &lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;
  &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;  &lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;!-- more --&gt;

&lt;p&gt;例えばこうしておくと一覧を配列出力しつつ、出力したいフィールドを指定出来る。viewだけで操作出来るのは楽チンだわ。
 詳しい書式はブログ等の記事を見るよりも、英語だけど&lt;a href="https://github.com/rails/jbuilder"&gt;rails/jbuilder · GitHub&lt;/a&gt;を見るとよさげ。&lt;/p&gt;
&lt;!-- more --&gt;

&lt;h2&gt;jbuilderでネストした配列を出力する&lt;/h2&gt;
&lt;p&gt;大抵の説明では一番外側が配列で、中身はハッシュというものばかりで、配列の中が配列という形での出力方法の説明が無かったのでメモ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;みたいなjsonを出力する場合&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vi"&gt;@events&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_i&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;という指定をする。&lt;/p&gt;</summary><category term="ruby"></category></entry><entry><title>Capistrano3でbitbucketからデプロイしようとしたらハマった話</title><link href="http://blog.shigepon.info/blog/2014/05/04/capistrano3-shows-error-when-deploy-from-bitbucket/" rel="alternate"></link><updated>2014-05-04T10:04:00+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-05-04:blog/2014/05/04/capistrano3-shows-error-when-deploy-from-bitbucket/</id><summary type="html">&lt;p&gt;まだデプロイ作業を途中までしか確認していないので、とりあえずハマったポイントを書いておく。
 デプロイ作業をテストしてみたらこんなエラーが出た&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ bundle &lt;span class="nb"&gt;exec&lt;/span&gt; cap production deploy:check
 INFO &lt;span class="o"&gt;[&lt;/span&gt;5f874a7e&lt;span class="o"&gt;]&lt;/span&gt; Running /usr/bin/env mkdir -p /tmp/hoge/ on fuga
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;5f874a7e&lt;span class="o"&gt;]&lt;/span&gt; Command: /usr/bin/env mkdir -p /tmp/hoge/
 INFO &lt;span class="o"&gt;[&lt;/span&gt;5f874a7e&lt;span class="o"&gt;]&lt;/span&gt; Finished in 0.321 seconds with &lt;span class="nb"&gt;exit&lt;/span&gt; status &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;successful&lt;span class="o"&gt;)&lt;/span&gt;.
DEBUG Uploading /tmp/hoge/git-ssh.sh 0.0%
 INFO Uploading /tmp/hoge/git-ssh.sh 100.0%
 INFO &lt;span class="o"&gt;[&lt;/span&gt;c2bf6ab8&lt;span class="o"&gt;]&lt;/span&gt; Running /usr/bin/env chmod +x /tmp/hoge/git-ssh.sh on fuga
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;c2bf6ab8&lt;span class="o"&gt;]&lt;/span&gt; Command: /usr/bin/env chmod +x /tmp/hoge/git-ssh.sh
 INFO &lt;span class="o"&gt;[&lt;/span&gt;c2bf6ab8&lt;span class="o"&gt;]&lt;/span&gt; Finished in 0.031 seconds with &lt;span class="nb"&gt;exit&lt;/span&gt; status &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;successful&lt;span class="o"&gt;)&lt;/span&gt;.
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;ef8c5c38&lt;span class="o"&gt;]&lt;/span&gt; Running /usr/bin/env git ls-remote -h git@bitbucket.org:fuga/hoge.git on fuga
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;ef8c5c38&lt;span class="o"&gt;]&lt;/span&gt; Command: &lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="nv"&gt;GIT_ASKPASS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/bin/echo &lt;span class="nv"&gt;GIT_SSH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/tmp/hoge/git-ssh.sh /usr/bin/env git ls-remote -h git@bitbucket.org:fuga/hoge.git &lt;span class="o"&gt;)&lt;/span&gt;
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;cb27da31&lt;span class="o"&gt;]&lt;/span&gt;    Error reading response length from authentication socket
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;ef8c5c38&lt;span class="o"&gt;]&lt;/span&gt;    Permission denied &lt;span class="o"&gt;(&lt;/span&gt;publickey&lt;span class="o"&gt;)&lt;/span&gt;.
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;ef8c5c38&lt;span class="o"&gt;]&lt;/span&gt;    
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;ef8c5c38&lt;span class="o"&gt;]&lt;/span&gt;    fatal: The remote end hung up unexpectedly
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;ef8c5c38&lt;span class="o"&gt;]&lt;/span&gt;    
DEBUG &lt;span class="o"&gt;[&lt;/span&gt;ef8c5c38&lt;span class="o"&gt;]&lt;/span&gt; Finished in 2.287 seconds with &lt;span class="nb"&gt;exit&lt;/span&gt; status &lt;span class="m"&gt;128&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;failed&lt;span class="o"&gt;)&lt;/span&gt;.
&lt;/pre&gt;&lt;/div&gt;


&lt;!-- more --&gt;

&lt;p&gt;うげげ。gitで鍵認証のエラー出てるわ。とりあえずbitbucketに公開鍵を登録してみた。
 &lt;a href="http://morizyun.github.io/blog/ssh-key-bitbucket-github/"&gt;SSH認証キーをBitbucket/GitHubに設定しよう！ [Mac簡単手順] - 酒と泪とRubyとRailsと&lt;/a&gt;の通りに登録したら出来た。~/.ssh/configに秘密鍵を追加して&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Host bitbucket.org
  HostName bitbucket.org
  IdentityFile ~/.ssh/id_rsa
  User git
  TCPKeepAlive yes
  IdentitiesOnly yes
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;じゃあ再度デプロイをテストしてみたら・・・同じエラーが出た。
色々試行錯誤して、「Error reading response length from authentication socket」でググった結果、ssh_agentが動いてないことが判明したので&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;eval&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;ssh-agent -s&lt;span class="sb"&gt;`&lt;/span&gt;
$ ssh-add ~/.ssh/id_rsa
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;としてデプロイをテストしたら無事動いた。めでたしめでたし。でも一旦ログアウトしたりするとssh-agentに接続しないとまた同じエラーが出た。ssh-agentへの接続方法は&lt;a href="http://tipspc.blogspot.jp/2010/02/ssh-agent.html"&gt;PC便利帳: ssh-agentを使用したパスワードなしの接続&lt;/a&gt;を参考にして&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ps ax &lt;span class="p"&gt;|&lt;/span&gt; grep ssh-agent
$ ls /tmp &lt;span class="p"&gt;|&lt;/span&gt; grep ssh
$ &lt;span class="nv"&gt;SSH_AUTH_SOCK&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/tmp/ssh-XXXXX1111/agent.1111&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nb"&gt;export&lt;/span&gt; SSH_AUTH_SOCK&lt;span class="p"&gt;;&lt;/span&gt;
$ &lt;span class="nv"&gt;SSH_AGENT_PID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;2222&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nb"&gt;export&lt;/span&gt; SSH_AGENT_PID&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="sb"&gt;````&lt;/span&gt;

とやれば接続できて、デプロイできた。
 さらに実際にデプロイすると下のようにエラーでまくった。

&lt;span class="c1"&gt;##capistrano3でbundle exec cap production deloyしようとしたらエラーが出まくる&lt;/span&gt;
Gemfileから色々省いてたらエラーが出まくる

+ rubyが指定されてない（rbenvが足りない）
+ uglifierが無いとかsassが足りないとか
+ いちいちGemfile.lockをアップデートしないとエラー出る

rbenvはcapistrano-rbenvをGemfileに追加して、Capfileにcapistrano/rbenvを指定して、config/deploy.rbに

&lt;span class="sb"&gt;```&lt;/span&gt;rb
&lt;span class="nb"&gt;set&lt;/span&gt; :rbenv_ruby, &lt;span class="s1"&gt;&amp;#39;2.1.0&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;とか何とか設定するとおk。&lt;/p&gt;
&lt;p&gt;uglifierとかsassとかproductionを指定した場合に使うような設定になってるみたいい（config/environments/production.rb）。とりあえずuglifierとかsassとかcofee-railsとか色々Gemfileに入れておけばエラーでなかった。&lt;/p&gt;
&lt;h2&gt;デプロイした後でcss関連でエラーが出た&lt;/h2&gt;
&lt;p&gt;sassが足らないと言われた。sass使わないので、sassが関わるファイル（app/assets/stylesheets内のscssファイル）を消すとエラーは消えた&lt;/p&gt;
&lt;h2&gt;productionモードでデプロイすると、cssやjsを読み込んでくれない&lt;/h2&gt;
&lt;p&gt;config/environments/production.rbに次の行を追記&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assets&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
 &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assets&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;precompile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;*.js&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;*.css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;*.css.erb&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;参考&lt;a href="http://stackoverflow.com/questions/18700219/rails-4-assets-not-loading-in-production"&gt;ruby - Rails 4: assets not loading in production - Stack Overflow&lt;/a&gt;
すると解決した。なんかバッドノウハウみたいでやだ。&lt;/p&gt;
&lt;h2&gt;productionモードでunicornが起動してくれない&lt;/h2&gt;
&lt;p&gt;capistranoとは関係なかったけどcapistrano関連と思い込んでたのでメモ。capistranoの設定にミスがあると思って苦しんでたけど、単にunicornのオプションを指定してなかったのが悪かった。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ bundle &lt;span class="nb"&gt;exec&lt;/span&gt; unicorn_rails -E production
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;でおkだった。&lt;/p&gt;
&lt;p&gt;Capistranoは確かに便利なんだけど、なんかハマりポイントが多いような印象。
バージョン変わって設定方法も変わったみたいだし。最初のハードルが高い感じがする。慣れたら楽になるのかな。&lt;/p&gt;
&lt;h2&gt;capistrano3でunicornの再起動に失敗する&lt;/h2&gt;
&lt;p&gt;&lt;a href="http://qiita.com/satococoa/items/9b0cc416ffc042680b9b"&gt;unicorn + rails 用 Capistrano 3 の設定ファイル - Qiita&lt;/a&gt;と&lt;a href="http://blog.dealforest.net/2014/02/failed_restart_unicorn_with_capistrano3/"&gt;Capistrano3 で Unicorn の再起動に失敗したのを対応したメモ | Supernova&lt;/a&gt;が参考になった。&lt;/p&gt;
&lt;p&gt;でもrestartでちゃんと再起動して修正箇所が反映しない。stopしてstartしないと。うーん。&lt;/p&gt;</summary><category term="Rails"></category><category term="ruby"></category></entry><entry><title>nginx,unicornをさくらvpsにインストールしてrailsアプリを手動でデプロイしてみる</title><link href="http://blog.shigepon.info/blog/2014/05/02/use-nginxand-unicorn-on-sakura-vps/" rel="alternate"></link><updated>2014-05-02T15:10:23+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-05-02:blog/2014/05/02/use-nginxand-unicorn-on-sakura-vps/</id><summary type="html">&lt;p&gt;さくらvpsのUbuntu12.04にnginxとunicornをインストールしてローカル環境に作ったRailsアプリを手動でアップロードして表示させてみた。何となくユニコーンって名前が好きなので、unicornを使うことにした。&lt;/p&gt;
&lt;h2&gt;nginxインストール&lt;/h2&gt;
&lt;p&gt;nginxは本当は手動でインストールするのがいいんだろうけど、面倒なので&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo aptitude install nginx
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;でインストール&lt;/p&gt;
&lt;h2&gt;unicornインストール&lt;/h2&gt;
&lt;!-- more --&gt;

&lt;p&gt;rubyとかbundlerとかが必要なので、無い場合は&lt;a href="http://blog.shigepon.info/blog/2014/02/26/rails-startup/"&gt;Ruby on Railsを入れてみた&lt;/a&gt;に書いた通りにインストール。unicornはGemfileに&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gem &amp;quot;unicorn&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;と追記して&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ bundle install -path vendor/bundle
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;でインストール出来る。要らないかもしれないけどお約束のようにインストール後はrbenv rehashしておく。&lt;/p&gt;
&lt;h2&gt;nginxの設定&lt;/h2&gt;
&lt;p&gt;設定ファイルは最低限これくらい書いておけばよさげ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;upstream&lt;/span&gt; &lt;span class="nt"&gt;unicorn-unix-domain-socket&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="n"&gt;unix&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;unicorn&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;unicorn_&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;app_name&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt; &lt;span class="n"&gt;fail_timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nt"&gt;upstream&lt;/span&gt; &lt;span class="nt"&gt;unicorn-tcp&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="m"&gt;127&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;8080&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nt"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;server_name&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;://&lt;/span&gt;&lt;span class="n"&gt;hoge&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="n"&gt;root&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;app_root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;public&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="n"&gt;access_log&lt;/span&gt;  &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;access&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;error_log&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="n"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="err"&gt;{&lt;/span&gt;
                &lt;span class="n"&gt;proxy_pass&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;://&lt;/span&gt;&lt;span class="n"&gt;unicorn&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/var/run/unicornディレクトリは前もって作っておく。/tmpとかでも良さげなんだけど、どうなんだろう？&lt;/p&gt;
&lt;h2&gt;railsアプリのアップロード&lt;/h2&gt;
&lt;p&gt;適当にアップロード。rsyncで適当にやった。&lt;/p&gt;
&lt;h2&gt;unicorn起動&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ bundle &lt;span class="nb"&gt;exec&lt;/span&gt; unicorn_rails -D
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;-Dはデーモンとして起動。configファイルを指定する場合は、-c path/to/config.rbを指定する。&lt;/p&gt;
&lt;h2&gt;nginx起動&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ service nginx start
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;以上でrailsアプリが見れるようになる。&lt;/p&gt;</summary><category term="Rails"></category><category term="ruby"></category></entry><entry><title>Rails4でPostgreSQLとBootstrap使ったアプリを作ってみた(4):ビューにBootstrapを使う</title><link href="http://blog.shigepon.info/blog/2014/03/14/a-way-of-creating-rails-application4/" rel="alternate"></link><updated>2014-03-14T09:10:41+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-03-14:blog/2014/03/14/a-way-of-creating-rails-application4/</id><summary type="html">&lt;p&gt;参考にした記事URL一覧&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://ubiqlog.com/archives/8749"&gt;Ruby on Rails 4.0正式リリースとBootstrapの正しい設定法 | ユービックログ研究所&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://railscasts.com/episodes/328-twitter-bootstrap-basics?language=ja&amp;amp;view=asciicast"&gt;#328 Twitter Bootstrap Basics - RailsCasts&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;今回はそっけない表示画面をそれっぽくするためにビューにBootstrapを当てはめる。&lt;/p&gt;
&lt;p&gt;Gemfileを編集&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;+gem &amp;#39;less-rails&amp;#39;
+gem &amp;#39;twitter-bootstrap-rails&amp;#39;
+gem &amp;#39;execjs&amp;#39;
-gem &amp;#39;sass-rails&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;!-- more --&gt;

&lt;p&gt;以下のコマンドを実行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ bundle install
$ rails g bootstrap:install
$ rails g bootstrap:layout application
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;と実行したけど、最後のコマンドはビューを勝手に色々いじるので、しない方が良いかもしれない。上のコマンドを実行すると&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;app/assets/javascripts/application.js
app/assets/javascripts/bootstrap.js.coffee
app/assets/stylesheets/application.css
app/assets/stylesheets/bootstrap_and_overrides.css.less
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;が出来る。さて、この状態で出力を見ると、ページ上部がナビゲーションバーで隠れてしまった。
app/assets/stylesheets/bootstrap_and_overrides.css.lessを修正することで対処する&lt;/p&gt;
&lt;p&gt;変更前&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;@import&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;twitter/bootstrap/bootstrap&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;@import&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;twitter/bootstrap/responsive&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;変更後&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;@import&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;twitter/bootstrap/bootstrap&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nt"&gt;body&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nb"&gt;padding-top&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;60px&lt;/span&gt;&lt;span class="p"&gt;;}&lt;/span&gt;
&lt;span class="k"&gt;@import&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;twitter/bootstrap/responsive&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;これでページが隠れなくなる。レイアウト変更にはapp/views/layouts/application.html.erbを編集する必要がある。&lt;/p&gt;</summary><category term="ruby"></category><category term="Rails"></category><category term="PostgreSQL"></category><category term="Bootstrap"></category></entry><entry><title>Rails4でPostgreSQLとBootstrap使ったアプリを作ってみた(1):とりあえずRailsアプリを作ってみた</title><link href="http://blog.shigepon.info/blog/2014/03/10/a-way-of-creating-rails-application/" rel="alternate"></link><updated>2014-03-10T18:10:41+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-03-10:blog/2014/03/10/a-way-of-creating-rails-application/</id><summary type="html">&lt;p&gt;参考にした記事URL一覧&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://openbook4.me/projects/92"&gt;小学生でもわかるRuby on Rails入門 | OpenBook&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.oiax.jp/rails3book/setup_postgresql.html"&gt;データベースとの接続（PostgreSQL編） - Ruby on Rails with OIAX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://qiita.com/stkn_bb/items/72d06c149d3e6f315f8c"&gt;[Rails]既存のMySQLテーブルに接続する方法 - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://ubiqlog.com/archives/8749"&gt;Ruby on Rails 4.0正式リリースとBootstrapの正しい設定法 | ユービックログ研究所&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://railscasts.com/episodes/328-twitter-bootstrap-basics?language=ja&amp;amp;view=asciicast"&gt;#328 Twitter Bootstrap Basics - RailsCasts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://qiita.com/somewhatgood@github/items/9890e75b4c195d47715a"&gt;Rails - link_to の引数と展開の違いまとめ - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;基本的なところは&lt;a href="http://openbook4.me/projects/92"&gt;小学生でもわかるRuby on Rails入門 | OpenBook&lt;/a&gt;をなぞってみる。
ただし、PostgreSQLの既存テーブルを使い、テンプレートにBootstrapを使うので、途中から色々やることが変わっている。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ rails new bocho
&lt;/pre&gt;&lt;/div&gt;


&lt;!-- more --&gt;

&lt;p&gt;&lt;a href=""&gt;Ruby on Railsを入れてみた&lt;/a&gt;に注意点であげたようにGemfileからtherubyracerに関する行をコメントアウトしてbundle install 
これをしないとrails g controllerコマンドで&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;autodetect&lt;span class="s1"&gt;&amp;#39;: Could not find a Javascript runtime. ...&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;というエラーが出た&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ rails g controller events index show
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;と入力してビューとコントローラーを作った。これの意味はeventsというコントローラーとindex、showというビューを作る。ビューはスペース区切りで複数書けるみたい。indexはデータ一覧、showは個別データの表示を意味している
ファイルとしては&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;app/controllers/events_controller.rb
app/views/events/index.html.erb
app/views/events/show.html.erb
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;が出来る。events_controller.rbにはindexとshowメソッドが入っている&lt;/p&gt;
&lt;h3&gt;確認&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ rails s
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;でサーバを起動させて、[http://0.0.0.0:3000/events/index]と[http://0.0.0.0:3000/events/show]を確認&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Events##index
Find me in app/view/events/index.html.erb
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;みたいなメッセージが出てたらおk&lt;/p&gt;
&lt;h3&gt;コントローラー、ビューを修正&lt;/h3&gt;
&lt;p&gt;ビューって言っていいのかテンプレートなのか良くわからないけどapp/views/events/show.html.erbを修正&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="vi"&gt;@event&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:name&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;これで[http://0.0.0.0:3000/events/show]を確認するとエラーが表示される。&lt;/p&gt;
&lt;p&gt;@eventが登録されてないので、コントローラーで登録する&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;show&lt;/span&gt;
      &lt;span class="vi"&gt;@event&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Hash&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;
          &lt;span class="vi"&gt;@event&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:name&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;hoge&amp;#39;&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;これでさっきのURLにアクセスすると&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;hoge&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;と表示される。なるほど@変数名に値を入れたらテンプレでアクセス出来るようになるのね。&lt;/p&gt;
&lt;h3&gt;URLにパラメーターを入れる&lt;/h3&gt;
&lt;p&gt;テーブルのidが1のデータを[http://0.0.0.0:3000/events/show/1]で表示出来るように考える。
そのためにはconfig/routes.rbを&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;events/show/&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;events/show/:eventid&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;events#show&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;こうすると上のURLにアクセスするとevents_controller.rbのshowメソッド内でparams[:eventid]に1が入る
events_controller.rbを次のように変えると&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;show&lt;/span&gt;
      &lt;span class="vi"&gt;@event&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Hash&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;
          &lt;span class="vi"&gt;@event&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:name&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:eventid&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;[http://0.0.0.0:3000/events/show/1]にアクセスすると&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;1&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;と表示されるようになる。（あくまでこういうコードはテスト用）
とりあえずここまで&lt;/p&gt;</summary><category term="ruby"></category><category term="Rails"></category><category term="PostgreSQL"></category><category term="Bootstrap"></category></entry><entry><title>Rails4でPostgreSQLとBootstrap使ったアプリを作ってみた(2):データベースにPostgreSQLを使ってみた</title><link href="http://blog.shigepon.info/blog/2014/03/10/a-way-of-creating-rails-application2/" rel="alternate"></link><updated>2014-03-10T18:10:41+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-03-10:blog/2014/03/10/a-way-of-creating-rails-application2/</id><summary type="html">&lt;p&gt;参考にした記事URL一覧&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://openbook4.me/projects/92"&gt;小学生でもわかるRuby on Rails入門 | OpenBook&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.oiax.jp/rails3book/setup_postgresql.html"&gt;データベースとの接続（PostgreSQL編） - Ruby on Rails with OIAX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://qiita.com/stkn_bb/items/72d06c149d3e6f315f8c"&gt;[Rails]既存のMySQLテーブルに接続する方法 - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;前回に引き続き&lt;a href="http://openbook4.me/projects/92"&gt;小学生でもわかるRuby on Rails入門 | OpenBook&lt;/a&gt;を参考にしているが、色々すっとばしてデータベースを作るところをなぞる。
どうもモデルを作って、コマンド打ったら自動的にテーブル作ってくれてよしなにしてくれるらしい。&lt;/p&gt;
&lt;p&gt;ではモデルを作る。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ rails g model event name:string date:timestamp 
&lt;/pre&gt;&lt;/div&gt;


&lt;!-- more --&gt;

&lt;p&gt;モデルは単数型の英語で書くのが良いらしい。idは書かなくても自動で設定してくれるらしい。コマンドを実行すると次のようなファイルが出来る&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;app/models/event.rb
db/migrate/20140310033758_create_events.rb
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;後でテーブルの生成が上手く行かない場合に、変数の型で変なのを設定してる場合とかあるので、migrateフォルダのファイルを修正すると上手くいくことがある。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;rake db:migrate
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;と打ったらテーブルが出来た。めでたしめでたし・・・と思ったらそういえばリモートサーバ上のPostgreSQLテーブルにデータ入れてたのを思い出したので、sqliteからPostgreSQLに使用データベースを変更してみる。&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.oiax.jp/rails3book/setup_postgresql.html"&gt;データベースとの接続（PostgreSQL編） - Ruby on Rails with OIAX&lt;/a&gt;を参考にしたが、PostgreSQLの設定までは終了しているので、その後の部分をやってみた。&lt;/p&gt;
&lt;h3&gt;Gemfileを編集&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gem &amp;quot;sqlite3&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;を&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gem &amp;quot;pg&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;に変更して、bundle installを実行。すると何かエラーが・・・メッセージを見ると&lt;a href="http://qiita.com/youcune/items/5b783f7fde45d0fd4b35"&gt;Ruby - gem install pgしてNo pg_configとなる対処法 - Qiita&lt;/a&gt;が参考になりそうなので、libpq-devを入れてエラーを解消した（Ubuntuの場合)&lt;/p&gt;
&lt;h3&gt;config/database.yamlを編集&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;development&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;adapter&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;sqlite3&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;database&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;db/development.sqlite3&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pool&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;5&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;timeout&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;5000&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;みたいな箇所を&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;development&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;adapter&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;postgresql&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;host&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;000.000.00.00&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;port&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;5432&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;database&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;bocho&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;username&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="err"&gt;****&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;password&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="err"&gt;****&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pool&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;5&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;timeout&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;5000&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;に変更した。development以外にtest, productionと項目があって、それぞれ同じように変更した。これがどう違うのかはまだ勉強してない。localhostの場合はhost,portは要らないみたい。&lt;/p&gt;
&lt;h3&gt;テーブル名の変更&lt;/h3&gt;
&lt;p&gt;良く考えたら、PostgreSQLに保存してるデータのテーブルはeventsじゃなくてbochoだったので、そういう設定もしないといけない。その方法は&lt;a href="http://qiita.com/stkn_bb/items/72d06c149d3e6f315f8c"&gt;[Rails]既存のMySQLテーブルに接続する方法 - Qiita&lt;/a&gt;を参考にした。eventモデル(app/models/event.rb)を次のように変更&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Event&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;
    &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;table_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;bocho&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;なんかググったら他の書式もあったけど、それだとエラー出たので、今はこの書き方なのかな？ 
これで準備が出来たので、テーブルからデータを読み込んで表示してみる&lt;/p&gt;
&lt;h3&gt;データ読み込み&lt;/h3&gt;
&lt;p&gt;app/controllers/events_controller.rbを次のように書き換え&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;show&lt;/span&gt;
      &lt;span class="vi"&gt;@event&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:eventid&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;これ多分&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="vi"&gt;@event&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:eventid&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;でもいける。&lt;/p&gt;
&lt;h3&gt;データ表示&lt;/h3&gt;
&lt;p&gt;app/views/events/show.html.erbを編集&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;h1&amp;gt;Event&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;&amp;lt;dl&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;dt&amp;gt;日時&amp;lt;/dt&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;dd&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="vi"&gt;@event&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:date&lt;/span&gt;&lt;span class="o"&gt;].&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;%Y/%m/%d %H:%m&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/dd&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;dt&amp;gt;イベント名&amp;lt;/dt&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;dd&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="vi"&gt;@event&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:name&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/dd&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;&amp;lt;/dl&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;dd&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="vi"&gt;@event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;%Y/%m/%d %H:%m&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/dd&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;でもおk&lt;/p&gt;
&lt;p&gt;以上の作業後に [http://0.0.0.0:3000/events/show/1]にアクセスすると 
id=1,date=2014/03/01 10:00:00,name=ほげ 
というデータが入っていた場合、&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Event&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;dl&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;日時&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;dd&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;2014/03/01 10:00&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;dd&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;イベント名&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;dd&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;ほげ&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;dd&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;dl&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;と表示されたりする。&lt;/p&gt;</summary><category term="ruby"></category><category term="Rails"></category><category term="PostgreSQL"></category><category term="Bootstrap"></category></entry><entry><title>Rails4でPostgreSQLとBootstrap使ったアプリを作ってみた(3):データ一覧ページを作って、詳細ページへのリンクを貼る</title><link href="http://blog.shigepon.info/blog/2014/03/10/a-way-of-creating-rails-application3/" rel="alternate"></link><updated>2014-03-10T18:10:41+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-03-10:blog/2014/03/10/a-way-of-creating-rails-application3/</id><summary type="html">&lt;p&gt;参考にした記事URL一覧&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://openbook4.me/projects/92"&gt;小学生でもわかるRuby on Rails入門 | OpenBook&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://qiita.com/somewhatgood@github/items/9890e75b4c195d47715a"&gt;Rails - link_to の引数と展開の違いまとめ - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;前回に引き続き&lt;a href="http://openbook4.me/projects/92"&gt;小学生でもわかるRuby on Rails入門 | OpenBook&lt;/a&gt;を参考にしているが、色々すっとばして16章から適当に確認しながら適当に実装する。&lt;/p&gt;
&lt;h3&gt;一覧表示&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;
  &lt;span class="vi"&gt;@events&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;!-- more --&gt;

&lt;p&gt;と書くとテーブルにあるデータ全て取ってくるらしい（DAOで良くある書式）。
ビューでは@eventsに対してループさせる必要があるので次のような書式になる。
app/views/events/index.html.erbを次のように書き換える&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;h1&amp;gt;Events&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;&amp;lt;table class=&amp;quot;table&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;thead&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;        &amp;lt;th&amp;gt;日時&amp;lt;/th&amp;gt;&amp;lt;th&amp;gt;イベント名&amp;lt;/th&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;/thead&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%&lt;/span&gt; &lt;span class="vi"&gt;@events&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;        &amp;lt;tr&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;            &amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;%Y/%m/%d %H:%m&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;            &amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;        &amp;lt;/tr&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%&lt;/span&gt; &lt;span class="k"&gt;end&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;&amp;lt;/table&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;[http://0.0.0.0:3000/events/index]にアクセスすれば一覧が表示される。どこかのページでeachでなくeach_with_indexという書き方してるページあったけど、Rails4では動かなかった。
バージョン違い？&lt;/p&gt;
&lt;h3&gt;リンクを貼る&lt;/h3&gt;
&lt;p&gt;一覧と詳細を繋げたいので、リンクを貼る。link_toというのを使うらしい。 &lt;a href="http://qiita.com/somewhatgood@github/items/9890e75b4c195d47715a"&gt;Rails - link_to の引数と展開の違いまとめ - Qiita&lt;/a&gt;の「基本」を使えば今回は十分。上のerbを次のように書き換える&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;h1&amp;gt;Events&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;&amp;lt;table class=&amp;quot;table&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;thead&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;        &amp;lt;th&amp;gt;日時&amp;lt;/th&amp;gt;&amp;lt;th&amp;gt;イベント名&amp;lt;/th&amp;gt;&amp;lt;th&amp;gt;link&amp;lt;/th&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;/thead&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%&lt;/span&gt; &lt;span class="vi"&gt;@events&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;        &amp;lt;tr&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;            &amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;%Y/%m/%d %H:%m&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;            &amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;            &amp;lt;td&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;詳細&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="ss"&gt;:controller&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;events&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="ss"&gt;:action&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;show&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="ss"&gt;:eventid&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;        &amp;lt;/tr&amp;gt;&lt;/span&gt;
&lt;span class="x"&gt;    &lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%&lt;/span&gt; &lt;span class="k"&gt;end&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;&amp;lt;/table&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;controllerはコントローラー、actionはビュー？かどうか分からないけど、コントローラー内で定義してるメソッド、あとパラメーター名（eventid）はconfig/routes.rbで指定したパラメーター名が使用出来る（と思う）。とりあえずこう作ったけど、最終的にハッシュにした方がいいんだろな。&lt;/p&gt;
&lt;h3&gt;一覧の範囲を絞り込む&lt;/h3&gt;
&lt;p&gt;テーブルのデータ全部でなく、一部のデータに絞り込んで表示してみる。
日付のデータがあるので、今月のデータに絞り込んでみる。app/controllers/events_controller.rbを編集&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;
      &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;at_beginning_of_month&lt;/span&gt;
      &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;from&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;month&lt;/span&gt;
      &lt;span class="vi"&gt;@events&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:conditions&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;date&amp;gt;=? and date&amp;lt;=?&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;from&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="ss"&gt;:order&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;date&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ここらへんは&lt;a href="http://waka.hatenablog.com/entry/2013/04/05/083349"&gt;ActiveRecordで日付の範囲指定 - yo_waka's blog&lt;/a&gt;を参考にしながら適当に実装した。ActiveRecordは色んな表現方法があるのでどうしたもんかな。ただ、数字も何でもオブジェクトってのは面白い。&lt;/p&gt;</summary><category term="ruby"></category><category term="Rails"></category><category term="PostgreSQL"></category><category term="Bootstrap"></category></entry><entry><title>Ruby on Railsを入れてみた</title><link href="http://blog.shigepon.info/blog/2014/02/26/rails-startup/" rel="alternate"></link><updated>2014-02-26T14:51:16+09:00</updated><author><name>shigepon</name></author><id>tag:blog.shigepon.info,2014-02-26:blog/2014/02/26/rails-startup/</id><summary type="html">&lt;p&gt;rhaco使わないでWebサービス作るならもうPHP使わずに他の言語でやってみようかなと思い、
DjangoとRailsを迷ったあげく、ChefでRuby使うからRubyの勉強という意味を込めてRailsでやってみることにした。&lt;/p&gt;
&lt;p&gt;とりあえずまずはインストール出来ないと話にならないので、Railsをインストールしてみた話。&lt;/p&gt;
&lt;p&gt;Ubuntu使ってるので、aptitude install railsでさくっと終わるかなと思ってTwitterで何となく&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;shigepon: railsはバージョンいくつを使うと吉なんでしょ？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;とつぶやいたら、@sugamasaoさんから&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;sugamasao: @shigepon しがらみがなければ、最新の4.0.2が良いと思います。お試しで触って見るなら、4.1のbeta版を使って見ても良いかもしれません〜&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;

&lt;p&gt;という話が！そうなるとrubyも2系入れないとダメじゃん！と思いつつ&lt;/p&gt;
&lt;!-- more --&gt;

&lt;blockquote&gt;
&lt;p&gt;shigepon: @sugamasao ただ、うちのubuntuのrubyが1.8なので、まずは2.0にしないといけないっすね。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;とボヤいたら、やっぱり&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;sugamasao: @shigepon なるほど〜！1.8系はもうオワコンなので、2系を入れたほうが良いですねwちなみに、いまは2.1がリリースされてます！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;とのお達しが。んじゃ2系入れるかとググりながらインストールしてみた。
参考にしたページは次のとおり&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://qiita.com/emadurandal/items/a60886152a4c99ce1017"&gt;Rails開発環境の構築（rbenvでRuby導入からBundler、Rails導入まで） - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/19031633/starting-the-rails-sqlite3-error"&gt;Starting the rails, sqlite3 Error - Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://kiyotakagoto.hatenablog.com/entry/2013/05/28/235727"&gt;rails server 時に `autodetect': Could not find a JavaScript runtime が出たら。 - 人生ずっと勉強&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;手順&lt;/h3&gt;
&lt;p&gt;行ったり来たりしてるからこんな感じでスッと出来てないけど、だいたいこんな感じ&lt;/p&gt;
&lt;h4&gt;rbenvインストール&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone git://github.com/sstephenson/rbenv.git ~/.rbenv
mkdir -p ~/.rbenv/plugins
git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;~/.profileに以下を追加&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;&lt;span class="s2"&gt;/.rbenv/bin:&lt;/span&gt;&lt;span class="nv"&gt;$PATH&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;eval&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;rbenv init -&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;んで&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;source ~/.profile
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;opensslは入ってたから特に何もしなかったけど必要なら&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo aptitude install openssl
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;iconv, readlineは最初から入ってるんじゃないかな？
んでインストール&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo rbenv install -l
rbenv install 2.1.0
rbenv global 2.1.0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;rbenvで何かやったら&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;rbenv rehash
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;を忘れずに&lt;/p&gt;
&lt;h3&gt;Bundlerインストール&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;rbenv exec gem install bundler
rbenv rehash
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Railsインストール&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;bundle init
vim Gemfile
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Gemfile内に&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gem &amp;quot;rails&amp;quot;, &amp;quot;4.0.2&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;を追加。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;bundle install --path vendor/bundle
bundle exec rails new hoge --skip-bundle
rm -f Gemfile
rm -f Gemfile.lock
rm -rf .bundle
rm -rf vendor/bundle
cd hoge
bundle install --path vendor/bundle
echo &amp;#39;/vendor/bundle&amp;#39; &amp;gt;&amp;gt; .gitignore
bundle exec rails server
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;で途中下のようにハマりながら起動を確認した。&lt;/p&gt;
&lt;h3&gt;はまったポイント&lt;/h3&gt;
&lt;p&gt;Ruby on Railsをインストールする時にプロジェクトのディレクトリで&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;bundle install -path vendor/bundle
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;すると、&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Gem::Installer::ExtensionBuildError: ERROR: Failed to build gem native extension.

        /usr/bin/ruby1.9.1 extconf.rb 
checking for sqlite3.h... no
sqlite3.h is missing. Try &amp;#39;port install sqlite3 +universal&amp;#39;
or &amp;#39;yum install sqlite-devel&amp;#39; and check your shared library search path (the
location where your sqlite3 shared library is located).
*** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of
necessary libraries and/or headers.  Check the mkmf.log file for more
details.  You may need configuration options.

Provided configuration options:
    --with-opt-dir
    --without-opt-dir
    --with-opt-include
    --without-opt-include=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;opt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;dir&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;/include
    --with-opt-lib
    --without-opt-lib=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;opt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;dir&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;/lib
    --with-make-prog
    --without-make-prog
    --srcdir=.
    --curdir
    --ruby=/usr/bin/ruby1.9.1
    --with-sqlite3-dir
    --without-sqlite3-dir
    --with-sqlite3-include
    --without-sqlite3-include=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;dir&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;/include
    --with-sqlite3-lib
    --without-sqlite3-lib=&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;sqlite3&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;dir&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;/lib
    --enable-local
    --disable-local


Gem files will remain installed in /home/helio/.bundler/tmp/23089/gems/sqlite3-1.3.8 for inspection.
Results logged to /home/helio/.bundler/tmp/23089/gems/sqlite3-1.3.8/ext/sqlite3/gem_make.out

An error occurred while installing sqlite3 (1.3.8), and Bundler
cannot continue.
Make sure that `gem install sqlite3 -v &amp;#39;1.3.8&amp;#39;` succeeds before
bundling.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;というエラーが出たのは&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo aptitude install sqlite3 libsqlite3-dev
bundle install --path vendor/bundle
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;で出なくなった。インストールパスの指定が無ければpathオプションは要らない。&lt;/p&gt;
&lt;p&gt;bundle exec rails serverで&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;autodetect&amp;#39;: Could not find a JavaScript runtime. See https://github.com/sstephenson/execjs for a list of available runtimes. (ExecJS::RuntimeUnavailable)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;というエラーが出て、サーバを起動出来なかった。これは
プロジェクトに入っているGemfileに書いてあるtherubyracerに関する行をコメントアウトして&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;bundle install --path vendor/bundle
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;とすれば起動出来るようになった。&lt;/p&gt;</summary><category term="ruby"></category><category term="Rails"></category></entry></feed>