<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>shigeponが関心のある技術情報など</title><link href="http://blog.thoz.org/" rel="alternate"></link><link href="http://blog.thoz.org/feeds/nedesiko.atom.xml" rel="self"></link><id>http://blog.thoz.org/</id><updated>2014-01-28T21:45:15+09:00</updated><entry><title>C++/CLIでなでしこのプラグインを作る方法(Visual C++ Express Edition)</title><link href="http://blog.thoz.org/2014/01/28/nadesiko-plugin/" rel="alternate"></link><updated>2014-01-28T21:45:15+09:00</updated><author><name>shigepon</name></author><id>tag:blog.thoz.org,2014-01-28:2014/01/28/nadesiko-plugin/</id><summary type="html">&lt;p&gt;なでしこでプラグインを作る時にC#を使いたかったので、その前段階としてC++/CLIでプラグインを作る方法を探ってみました。&lt;/p&gt;
&lt;p&gt;C++/CLIが使えると、.Netを使えるようになり、C#で作ったdllもVC++の参照設定から読み込んで使えるようになります。&lt;/p&gt;
&lt;p&gt;なでしこにはC++でプラグイン開発するためのsdkがあります。&lt;/p&gt;
&lt;p&gt;ただし、VC++で使用するには&lt;a href="http://www.himanavi.net/cgi/nade-bbs2/cbbs.cgi?mode=one&amp;amp;number=7462&amp;amp;type=7446&amp;amp;space=60&amp;amp;no=0"&gt;なでしこ質問掲示板&lt;/a&gt;にあるような設定をしなければいけません。（以下引用）&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Win32プロジェクトを作成&lt;/li&gt;
&lt;li&gt;plugins_sdk_cからソースを追加&lt;/li&gt;
&lt;li&gt;dnako_import.defを作成&lt;/li&gt;
&lt;li&gt;すべての構成でプロジェクトのプロパティを修正　全般→文字セットを「マルチ バイト文字セットを使用する」に変更　リンカ→入力→モジュール定義ファイルに「dnako_import.def」と入力&lt;/li&gt;
&lt;li&gt;ビルド&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- more --&gt;

&lt;p&gt;dnako_import.defは以下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;EXPORTS
ImportNakoFunction
PluginInfo
PluginVersion
PluginRequire
PluginInit
PluginFin
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;実際こちらで試した場合は他にも4の箇所で&lt;/p&gt;
&lt;p&gt;全般→共通言語ランタイムサポートを「共通言語ランタイムサポートを使用しない」に
C/C++→プリコンパイル済みヘッダー→プリコンパイル済みヘッダーの作成/使用を「プリコンパイル済みヘッダーを使用しない」に&lt;/p&gt;
&lt;p&gt;変更が必要でした。&lt;/p&gt;
&lt;p&gt;ただし、この方法だとC++/CLIを使えないので、.Netを使うことは出来ません。そこで、次のように変更しました。&lt;/p&gt;
&lt;p&gt;+sdkに含まれる.cファイルを全て.cppに変更
+dnako_import\let.h内にある各GetProcAddressの第一引数hDllをstatic_castでHMODULE型にキャスト&lt;/p&gt;
&lt;p&gt;すると問題なくビルドが通り、.Netを使用することが出来ました。と言ってもMessageBoxを試した程度ですが。&lt;/p&gt;</summary><category term="nadesiko"></category><category term="CPlusPlus"></category><category term="CSharp"></category></entry></feed>